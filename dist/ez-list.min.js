!function(){"use strict";angular.module("ez.list",[])}(),function(){"use strict";angular.module("ez.list").constant("EzListConfig",{acceptClass:"ez-dragging",listChildrenField:"items",childrenField:"items",collapsedField:"collapsed",showPlaceholder:!0,collapsed:!0,allowDrag:!0,allowNesting:!0,allowInsertion:!0,openOnSlide:!0,dropOnly:!1,xThreshold:25,yThreshold:5})}(),function(){"use strict";angular.module("ez.list").directive("ezList",["EzListConfig","Draggable","$compile","$templateCache",function(a,b){return{restrict:"A",replace:!0,transclude:!0,scope:{item:"=?ezList",config:"=?ezConfig"},template:'<div class="ez-list" ng-class="{\'ez-list-draggable\': options.allowDrag, \'ez-no-placeholder\': !options.showPlaceholder, \'ez-droponly\': options.dropOnly, \'ez-list-empty\': !hasItems}"><ul class="ez-list-items"><li class="ez-list-item" ng-repeat="item in item[options.childrenField]" ng-include="\'ez-list-tpl.html\'"></li></ul></div>',link:function(c,d,e,f,g){c.options=angular.extend({},a,c.config),c.options.transclude=g;var h=d[0];c.options.dropOnly&&(c.options.allowInsertion=!1,c.options.allowNesting=!1,c.options.openOnSlide=!1,c.options.showPlaceholder=!1),c.item?c.$watchCollection("item."+c.options.childrenField,function(a,d){c.hasItems=a&&a.length,d&&0===d.length&&a.length>0&&b.unsetDropzone(h),d&&0===a.length&&(console.log("set ddd",h,a,d),b.setDropzone(h,c.options))}):(c.item={},c.hasItems=!1,b.setDropzone(h,c.options))}}}])}(),function(){"use strict";angular.module("ez.list").directive("ezListItem",["Draggable","$compile",function(a){return{restrict:"C",link:function(b,c){var d=c[0];b.options.transclude&&b.options.transclude(b,function(a){angular.element(d.children[0].children[0]).append(a)}),a.setDropzone(c[0].children[0].children[0],b.options),c.on(a.supportsTouch?"touchstart":"mousedown",function(c){(b.options.allowDrag===!0||"function"==typeof b.options.allowDrag&&b.options.allowDrag(c,b.item))&&a.init(c,b)}),b.item.hasOwnProperty("collapsed")||(b.item[b.options.collapsedField]=b.options.collapsed),b.$watchCollection("item."+b.options.childrenField,function(a){b.hasItems=a&&a.length}),b.remove=function(){b.$parent.$parent.item[b.options.childrenField].splice(b.$parent.$parent.item[b.options.childrenField].indexOf(b.item),1)}}}}])}(),function(){"use strict";angular.module("ez.list").factory("Draggable",[function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=angular.element('<ul class="ez-drag-container"></ul>')[0],s=angular.element('<li class="ez-placeholder"></li>')[0],t=0,u=0,v=0,w=0,x=0,y={};return{init:function(g,h){var i=this;!g.target.hasAttribute("ez-drag-handle")||"undefined"!=typeof g.button&&0!==g.button||(g.preventDefault(),g.stopPropagation(),$(document).one(interact.supportsTouch()?"touchend":"mouseup",function(){setTimeout(function(){i.destroy()})}),c=angular.element(g.target).closest(".ez-list-item"),b=c[0],n=$(g.target).closest(".ez-list"),m=n[0],o=n.isolateScope(),y=o.options,a=h.item,e=h.$parent.$parent,d=e.item,f=d[o.options.childrenField].indexOf(a),this.initDragContainer(),b.classList.add(o.options.acceptClass),console.log("start",b,b.parentNode),b.parentNode.insertBefore(s,b),r.parentNode!==m&&m.appendChild(r),r.appendChild(b),m.classList.add("ez-drag-origin"),m.classList.add("ez-list-target"),interact.dynamicDrop(!0),interact(b).draggable({onstart:i.start.bind(this),onmove:i.move.bind(this),onend:i.end.bind(this)}).actionChecker(function(a,b){return"undefined"!=typeof a.button?0===a.button?b:null:b}),interact.simulate("drag",b,g),b.classList.add("ez-dragging"))},setDropzone:function(a,b){interact(a).dropzone({accept:b.accept,ondragenter:this.enter.bind(this),ondragleave:this.leave.bind(this),ondrop:this.drop.bind(this)})},unsetDropzone:function(a){interact(a).dropzone(!1)},enter:function(a){return console.log("enter",a.target),i=a.target,j=angular.element(i),j.hasClass("ez-list")?p=a.target:(i=a.target.parentNode.parentNode,j=angular.element(i),i.classList.add("ez-dragover"),p=j.closest(".ez-list")[0]),p.classList.add("ez-list-target"),p===m?void console.log("no changed"):(m.classList.remove("ez-list-target"),m=p,n=angular.element(m),o=n.isolateScope(),void(p=null))},leave:function(a){console.log("leave"),i&&i.classList.remove("ez-dragover"),angular.element(a.target).hasClass("ez-list")?m.classList.remove("ez-list-target"):o.options.allowInsertion&&("up"===h?this.moveUp():this.moveDown()),i=null},drop:function(){console.log("DROP"),i&&i.classList.remove("ez-dragover"),o.options.hasOwnProperty("onDrop")&&o.options.onDrop(a,angular.element(i).scope().item)},start:function(){console.log("start");var a=this;q=!0,c.find(".ez-dropzone").each(function(){a.unsetDropzone($(this)[0])})},move:function(a){return v+=a.dx,w+=a.dy,this.setDragContainerElPosition(),o.options.allowInsertion?o.options.allowNesting&&0!==a.dx&&0===a.dy&&(g=a.dx>0?"right":"left",l!==g&&(x=0,l=g),x+=Math.abs(a.dx),x>o.options.xThreshold)?(x=0,void("right"===g?this.moveRight():this.moveLeft())):void(!i||Math.abs(a.dx)>5||0===a.dy||(h=a.dy>0?"down":"up")):void 0},end:function(){if(console.log("end"),i)j.hasClass("ez-list")?(console.log("hey",j),k=j.isolateScope().item):k=j.parent().scope().item;else{if(!s.parentNode)return;k=angular.element(s.parentNode).scope().item,console.log("plalal",k)}console.log("ddd",k,a),b.classList.remove(o.options.acceptClass),r.removeChild(b),d[y.childrenField].splice(f,1),e.$apply(),o.options.allowInsertion?(console.log("parent",k,a),k&&k.hasOwnProperty(o.options.childrenField)?k[o.options.childrenField].splice(this.getPlaceholderIndex(),0,a):k[o.options.childrenField]=[a]):i||(console.log("no insert"),d[e.options.childrenField].splice(f,0,a)),e.$apply(),interact.dynamicDrop(!1)},initDragContainer:function(){var a=m.getBoundingClientRect(),c=b.getBoundingClientRect();v=0,w=0,t=c.left-a.left,u=c.top-a.top,r.style.top=u+2+"px",r.style.left=t+2+"px",r.style.width=c.right-c.left-1+"px",this.setDragContainerElPosition()},setDragContainerElPosition:function(){r.style.webkitTransform=r.style.transform="translate("+v+"px, "+w+"px)"},resetDragContainerElPosition:function(){r.style.webkitTransform=r.style.transform="translate(0px, 0px)"},moveLeft:function(){var a=s.parentNode.parentNode.parentNode,b=a.parentNode;b&&"UL"===b.tagName&&(b.insertBefore(s,a.nextSibling),a=b=null)},getPlaceholderIndex:function(){return Array.prototype.indexOf.call(s.parentNode.children,s)},moveRight:function(){var a=s.previousElementSibling,b=angular.element(a),c=b.scope();a&&"LI"===a.tagName&&(c.options.openOnSlide&&c.item[c.options.collapsedField]===!0?(c.item[c.options.collapsedField]=!1,c.$apply(),a.children[0].children[1].insertBefore(s,a.children[0].children[1].children[0])):a.children[0].children[1].appendChild(s),a=b=null)},moveUp:function(){i.parentNode.insertBefore(s,i)},moveDown:function(){var a=i.children[0].children[1];a&&a.children[0]?a.insertBefore(s,a.children[0]):i.parentNode.insertBefore(s,i.nextElementSibling)},destroy:function(){q||s.parentNode.insertBefore(b,s),s.parentNode&&s.parentNode.removeChild(s),b.classList.remove("ez-dragging"),m.classList.remove("ez-drag-origin"),m.classList.remove("ez-list-target"),m=c=b=d=a=f=q=null}}}])}();