!function(){"use strict";angular.module("ez.list",[]).constant("EzListConfig",{acceptClass:"ez-dragging",listChildrenField:"items",childrenField:"items",collapsedField:"collapsed",showPlaceholder:!0,collapsed:!0,allowDrag:!0,allowNesting:!0,allowInsertion:!0,openOnSlide:!0,closeOnDrag:!1,dropOnly:!1,xThreshold:15,yThreshold:5}).directive("ezList",["EzListConfig","Draggable",function(a,b){return{restrict:"A",replace:!0,transclude:!0,scope:{item:"=?ezList",config:"=?ezConfig"},template:'<div class="ez-list" ng-class="{\'ez-list-draggable\': options.allowDrag, \'ez-no-placeholder\': !options.showPlaceholder, \'ez-droponly\': options.dropOnly, \'ez-list-empty\': !hasItems}"><ul class="ez-list-items"><li class="ez-list-item" ng-repeat="item in item[options.childrenField]" ng-include="\'ez-list-tpl.html\'"></li></ul></div>',link:function(c,d,e,f,g){c.options=angular.extend({},a,c.config),c.options.transclude=g;var h=d[0];c.options.dropOnly&&(c.options.allowInsertion=!1,c.options.allowNesting=!1,c.options.openOnSlide=!1,c.options.showPlaceholder=!1),c.item?c.$watchCollection("item."+c.options.childrenField,function(a){c.hasItems=a&&a.length,a&&a.length>0&&d.hasClass("has-dropzone")&&(d.removeClass("has-dropzone"),b.unsetDropzone(h)),a||d.hasClass("has-dropzone")||(d.addClass("has-dropzone"),b.setDropzone(h,c.options))}):(c.item={},c.hasItems=!1,d.addClass("has-dropzone"),b.setDropzone(h,c.options))}}}]).directive("ezListItem",["Draggable",function(a){return{restrict:"C",link:function(b,c){var d=c[0];b.options.transclude&&b.options.transclude(b,function(a){angular.element(d.children[0].children[0]).append(a)}),c.on(interact.supportsTouch()?"touchstart":"mousedown",function(c){(b.options.allowDrag===!0||"function"==typeof b.options.allowDrag&&b.options.allowDrag(c,b.item))&&a.init(c,b)}),b.item.hasOwnProperty("collapsed")||(b.item[b.options.collapsedField]=b.options.collapsed),b.$watchCollection("item."+b.options.childrenField,function(a){b.hasItems=a&&a.length}),b.remove=function(){b.$parent.$parent.item[b.options.childrenField].splice(b.$parent.$parent.item[b.options.childrenField].indexOf(b.item),1)},b.$on("$destroy",function(){a.unsetDropzone(c[0])})}}}]).factory("Draggable",[function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=angular.element('<ul class="ez-drag-container"></ul>')[0],w=angular.element('<li class="ez-placeholder"></li>')[0],x=0,y=0,z=0,A=0,B=0,C={};return{init:function(g,h){var i=this;!g.target.hasAttribute("ez-drag-handle")||"undefined"!=typeof g.button&&0!==g.button||(g.preventDefault(),g.stopPropagation(),$(document).one(interact.supportsTouch()?"touchend":"mouseup",function(){setTimeout(function(){i.destroy()})}),c=angular.element(g.target).closest(".ez-list-item"),b=c[0],p=$(g.target).closest(".ez-list"),o=p[0],q=p.isolateScope(),this.setDropzones(),C=q.options,a=h.item,e=h.$parent.$parent,d=e.item,f=d[q.options.childrenField].indexOf(a),this.initDragContainer(),C.closeOnDrag?(a[C.collapsedField]=!0,e.$apply()):w.style.height=c.height()+"px",b.classList.add(q.options.acceptClass),b.parentNode.insertBefore(w,b),v.parentNode!==o&&o.appendChild(v),v.appendChild(b),o.classList.add("ez-drag-origin"),o.classList.add("ez-list-target"),interact.dynamicDrop(!0),interact(b).draggable({onstart:i.start.bind(this),onmove:i.move.bind(this),onend:i.end.bind(this)}).actionChecker(function(a,b){return"undefined"!=typeof a.button?0===a.button?b:null:b}),interact.simulate("drag",b,g),b.classList.add("ez-dragging"))},setDropzones:function(){c.find(".ez-list-item-content").removeClass("ez-dropzone"),m=interact(".ez-dropzone").dropzone({ondragenter:this.enter.bind(this),ondragleave:this.leave.bind(this),ondrop:this.drop.bind(this)})},setDropzone:function(a,b){interact(a).dropzone({accept:b.accept,ondragenter:this.enter.bind(this),ondragleave:this.leave.bind(this),ondrop:this.drop.bind(this)})},unsetDropzone:function(a){interact(a).dropzone(!1)},unsetDropzones:function(){m.unset(),c.find(".ez-list-item-content").addClass("ez-dropzone")},enter:function(a){var b;angular.element(a.target).hasClass("ez-list")?(b=a.target,this.setDropItem(b)):(this.setDropItem(a.target.parentNode.parentNode),i.classList.add("ez-dragover"),b=j.closest(".ez-list")[0]),b!==o&&(o&&(r=o,s=p,t=q,r.classList.remove("ez-list-target")),o=b,p=angular.element(o),q=p.isolateScope(),o.classList.add("ez-list-target"),b=null)},leave:function(){i.classList.remove("ez-dragover"),j.hasClass("ez-list")?(o.classList.remove("ez-list-target"),o=null):q.options.allowInsertion&&("up"===h?this.moveUp():this.moveDown()),q.options.dropOnly&&(o=null)},drop:function(){i&&(i.classList.remove("ez-dragover"),q.options.hasOwnProperty("onDrop")&&q.options.onDrop(a,j.scope().item))},start:function(){u=!0},move:function(a){return z+=a.dx,A+=a.dy,this.setDragContainerElPosition(),null!==o&&q.options.allowInsertion?q.options.allowNesting&&0!==a.dx&&0===a.dy&&(g=a.dx>0?"right":"left",n!==g&&(B=0,n=g),B+=Math.abs(a.dx),B>q.options.xThreshold)?(B=0,void("right"===g?this.moveRight():this.moveLeft())):void(!i||Math.abs(a.dx)>5||0===a.dy||(h=a.dy>0?"down":"up")):void 0},end:function(){if(interact.dynamicDrop(!1),w.parentNode){var c=this.getPlaceholderIndex();l=angular.element(w.parentNode).scope().item,b.classList.remove(C.acceptClass),v.removeChild(b),d[C.childrenField].splice(f,1),e.$apply(),o&&q.options.dropOnly||(o&&q.options.allowInsertion?l&&l.hasOwnProperty(q.options.childrenField)?l[q.options.childrenField].splice(c,0,a):l[q.options.childrenField]=[a]:d[e.options.childrenField].splice(f,0,a),q.$apply())}},initDragContainer:function(){var a=o.getBoundingClientRect(),c=b.getBoundingClientRect();z=0,A=0,x=c.left-a.left,y=c.top-a.top,v.style.top=y+2+"px",v.style.left=x+2+"px",v.style.width=c.right-c.left-1+"px",this.setDragContainerElPosition()},setDropItem:function(a){i=a,j=angular.element(a),k=j.scope().item},setDragContainerElPosition:function(){v.style.webkitTransform=v.style.transform="translate3D("+z+"px, "+A+"px, 0px)"},moveLeft:function(){w.nextElementSibling||(this.setDropItem(w.parentNode.parentNode.parentNode),k&&i&&i.nextSibling&&i.parentNode.insertBefore(w,i.nextSibling))},getPlaceholderIndex:function(){return Array.prototype.indexOf.call(w.parentNode.children,w)},moveRight:function(){w.previousElementSibling&&(this.setDropItem(w.previousElementSibling),q.options.openOnSlide&&k[q.options.collapsedField]===!0?(k[q.options.collapsedField]=!1,q.$apply(),i.children[0].children[1].insertBefore(w,i.children[0].children[1].children[0])):i.children[0].children[1].appendChild(w))},moveUp:function(){i.parentNode.insertBefore(w,i)},moveDown:function(){var a=i.children[0].children[1];a&&a.children[0]?a.insertBefore(w,a.children[0]):i.parentNode.insertBefore(w,i.nextElementSibling)},destroy:function(){u||w.parentNode.insertBefore(b,w),w.parentNode&&w.parentNode.removeChild(w),b.classList.remove("ez-dragging"),o&&(o.classList.remove("ez-drag-origin"),o.classList.remove("ez-list-target")),r&&(r.classList.remove("ez-drag-origin"),r.classList.remove("ez-list-target")),this.unsetDropzones(),r=s=t=o=p=q=c=b=d=a=f=u=null}}}])}();